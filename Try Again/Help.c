/*** *	alles, was mit dem Help Manager zu tun hat… ***/#include "Help.h"#include "Windows.h"#include "GlobalLib.h"#include "WindowsGlobal.h"#include "DoEvent.h"Rect			gBalloonRect;			// Rechteck in dem sich der Mauspfeil befindetWORD			gBalloonID;				// ID des Balloons, der dargestellt werden soll (0 = keiner)WORD			gBalloonBase = 1000;	// Resource-ID der STR#-Resource für Balloons/*** *	Menüpunkt ggf. ans Help-Menü anhängen ***/VOID			AppendHelpMenu(VOID){MenuHandle		mh;REG WORD		i;Str255			s;	if (!gHasHelpMgr) return;			// kein Help Manager vorhanden => raus	if (HMGetHelpMenuHandle(&mh)) return;	// Abbruch, wenn Fehler	if (!mh) return;					// keine Handle => raus	for(i=1;i<99;i++) {		GetIndString(s,HelpMenuStr,i);	// String holen		if (!s[0]) break;				// String definiert?		AppendMenu(mh,s);				// dann dranhängen	}}/*** *	Menüpunkt im Help-Menü angewöhlt ***/#define BASE_RES_ID		171#define BASE_PICT_ID	145VOID			MHelp(WORD item){pascal void		Show_help(short help_dlog_id, StringPtr help_text_name,							short base_pict_id, StringPtr default_filename,							StringPtr default_menuname );REG StringHandle	s;	s = GetString(130);	if (!s) return;	HLock((Handle)s);	Show_help(BASE_RES_ID,"\phelp",BASE_PICT_ID,"\p",*s);	HUnlock((Handle)s);	UnloadSeg(Show_help);}/*** *	Test auf Balloon-Help und ggf. Message an das Window schicken ***/VOID			BalloonAktion(VOID){static WORD		lastBalloon = 0;REG Point		tip;WindowPtr		wind;REG WORD		part;REG WORD		balloon;HMMessageRecord	helpMessage;GrafPtr			oldPort;OSErr			err;	if (!gHasHelpMgr) return;			// kein Help Manager vorhanden => raus	if ((!HMGetBalloons()) ||			// Balloon Help ausgeschaltet		(!IsAppWindow(FrontWindow()))) {// oder kein eigenes Window getopped?		lastBalloon = 0;				// kein Balloon mehr vorhanden		return;							// raus	}	tip = gTheEvent.where;				// Mausposition ermitteln	part = FindWindow(tip,&wind);	if ((part != inContent) ||			// Mauszeiger nicht im Window?		(((WindPtr)wind != gTopWindow) && !IsFloating((WindPtr)wind))) { // und nicht in einem getoppten Window?		lastBalloon = 0;				// kein Balloon mehr vorhanden		return;							// raus	}	GetPort(&oldPort);	SetPort(wind);	gBalloonID = 0;						// Default: kein Balloon	WINDOW((WindPtr)wind,help,(long)0);	// Help-Balloon ermitteln	balloon = gBalloonID;				// in ein Register packen…	if (balloon) {						// Balloon darstellen?		if (balloon != lastBalloon) {	// ein andere Balloon?			helpMessage.hmmHelpType				= khmmStringRes;			helpMessage.u.hmmStringRes.hmmResID	= gBalloonBase;			helpMessage.u.hmmStringRes.hmmIndex	= balloon;			tip.h = (gBalloonRect.right - gBalloonRect.left) / 2 + gBalloonRect.left;			tip.v = (gBalloonRect.bottom - gBalloonRect.top) / 2 + gBalloonRect.top;			err = HMShowBalloon(&helpMessage,tip,&gBalloonRect,nil,0,0,false);			if (err == noErr)				lastBalloon = balloon;	// neuer aktiver Balloon		}	} else {							// alten Balloon ausschalten		if (lastBalloon) HMRemoveBalloon();		lastBalloon = 0;	}	SetPort(oldPort);}