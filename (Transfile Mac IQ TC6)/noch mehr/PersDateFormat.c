/*** *	Dialog für persöngliche Einstellungen ***/#include "rsrcDefines.h"#include "DialogLib.h"#include <Packages.h>Boolean			PersDateFormat(VOID);pascal Boolean	OwnDateFilter(DialogPtr d,EventRecord *event,WORD *item);UCHAR			GetPopupChar(DialogPtr d,WORD item);VOID			SetPopupChar(REG DialogPtr d,REG WORD item,UCHAR c);Intl0Hndl		PersIntl = 0L;/*** *	Zeichen aus einem Popup-Menü holen ***/UCHAR		GetPopupChar(REG DialogPtr d,REG WORD item){Str255	s;	GetPopupItem(d,item,GetPopupValue(d,item),s);	return(s[1]);}/*** *	Zeichen in einem Popup-Menü finden ***/VOID		SetPopupChar(REG DialogPtr d,REG WORD item,UCHAR c){Str255		s;REG WORD	i;	for(i=1;i<99;i++) {		GetPopupItem(d,item,i,s);		if (s[1] == c) {			SetPopupValue(d,item,i);			break;		}	}}/*** *	eigener Dialoghandler für die Darstellung der Uhrzeit ***/static LONG	lasttime = 0L;pascal Boolean	OwnDateFilter(REG DialogPtr d,EventRecord *event,WORD *item){Str255		s1,s2;ULONG		time;	if (PersIntl) {							// Intl-Resource vorhanden?		d = (DialogPtr)FrontWindow();		// oberstes Window sollte unser Dialog sein		GetDateTime(&time);		if (time != lasttime) {			IUTimePString(time,true,s1,(Handle)PersIntl);			Strpcat2(s1,"\p  ");			IUDatePString(time,(DateForm)shortDate,s2,(Handle)PersIntl);			Strpcat2(s1,s2);			SetIText((Handle)GetCH(d,14),s1);		// Uhrzeit + Datum ausgeben			lasttime = time;		}	}	return(OwnDialogFilter(d,event,item));	// allgemeinen Dialoghandler aufrufen}/*** *	Dialog für das persönliche Format ausführen ***/Boolean		PersDateFormat(VOID){REG DialogPtr	d = GetCenteredDialog(PersDateRsrc,nil);REG WORD		button;CHAR			dateformat[] = { mdy,dmy,ymd,myd,dym,ydm };REG WORD		i;REG Intl0Ptr	p;	if (!d) return(false);	PersIntl = (Intl0Hndl)GetResource('itl0',2000);	// Persönliches Format einlesen	HLock((Handle)PersIntl);	p = *PersIntl;	NewPopup(d,11,158,18,1);		// Sortierung	NewPopup(d,12,159,19,1);		// Datumstrenner	NewPopup(d,13,163,20,1);		// Zeittrenner	OutlineDialogItem(d,1);			// Default-Button zeichnen	do {		SetButton(d,4,(p->shrtDateFmt & dayLdingZ) == dayLdingZ);		SetButton(d,5,(p->shrtDateFmt & mntLdingZ) == mntLdingZ);		SetButton(d,6,(p->shrtDateFmt & century) == century);		SetButton(d,7,(p->timeFmt & hrLeadingZ) == hrLeadingZ);		SetButton(d,8,(p->timeFmt & minLeadingZ) == minLeadingZ);		SetButton(d,9,(p->timeFmt & secLeadingZ) == secLeadingZ);		SetButton(d,10,(p->timeCycle == 0xFF));		for(i=0;i<sizeof(dateformat);i++)			if (dateformat[i] == p->dateOrder) {				SetPopupValue(d,11,i+1);				break;			}		SetPopupChar(d,12,p->dateSep);		SetPopupChar(d,13,p->timeSep);		{ WORD but;			ModalDialog((ModalFilterProcPtr)OwnDateFilter,&but);			button = but;		}		if ((button==1)||(button==3)) break;		switch(button) {		case	4:	p->shrtDateFmt ^= dayLdingZ; break;		case	5:	p->shrtDateFmt ^= mntLdingZ; break;		case	6:	p->shrtDateFmt ^= century; break;		case	7:	p->timeFmt ^= hrLeadingZ; break;		case	8:	p->timeFmt ^= minLeadingZ; break;		case	9:	p->timeFmt ^= secLeadingZ; break;		case	10:	p->timeCycle ^= 0xFF; break;		case	11:	p->dateOrder = dateformat[GetPopupValue(d,11)-1]; break;		case	12:	p->dateSep = GetPopupChar(d,12); break;		case	13:	p->timeSep = GetPopupChar(d,13); break;		}		if (button>=1)			lasttime = 0L;					// Redraw der Uhrzeit sofort erzwingen	} while(1);	DisposeObjects(d);	DisposDialog(d);	HUnlock((Handle)PersIntl);	if (button == 1) {						// “OK”?		ChangedResource((Handle)PersIntl);		WriteResource((Handle)PersIntl);	// geänderte Resource wegschreiben	}	ReleaseResource((Handle)PersIntl);	return(button==1);						// True, wenn “OK” angewählt}