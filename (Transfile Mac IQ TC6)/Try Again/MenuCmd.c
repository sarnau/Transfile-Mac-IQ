/*** *	MenuCmd.c * *	©1991 ∑-Soft, Markus Fritze ***/#include "GlobalDefines.h"#include "MenuCmd.h"#include "Document.h"#include "DoEvent.h"#include "GeosMore.h"#include "rsrcDefines.h"#include "GlobalStruct.h"#include "Install.h"#include "AktDocStruct.h"#include "Print.h"/*** *	“New” angewählt ***/void	MNew(void){DocHandle		d;REG OSErr		err;#if ONEDOC	MClose();			// altes Dokument schließen	if (gDoc)			// Dokument noch offen?		return;			// dann raus!#endif	err = AppNewDocument(&d);			// neues Dokument anlegen	err = AppInitDocument(d,iNew,err);	CheckOSError(err);					// ein Fehler => raus}/*** *	“Open…” angewählt ***/void	MOpen(void){DocHandle		d;REG OSErr		err;#if ONEDOC	MClose();			// altes Dokument schließen	if (gDoc)			// Dokument noch offen?		return;			// dann raus!#endif	err = AppOpenDocument(&d,nil,fsRdWrPerm);	// neues Dokument anlegen	if (err == userCanceledErr) return;	// Abbruch durch den User?	err = AppInitDocument(d,iOpen,err);	CheckOSError(err);					// ein Fehler => raus}/*** *	“Close” angewählt ***/void	MClose(void){REG OSErr		err;	err = AppSaveDocument(gDoc,iClose);	// Dokument schließen	if (err == userCanceledErr) return;	// Abbruch durch den User?	if (!CheckOSError(err)) return;		// ein Fehler => raus	AppDisposeDocument(gDoc);			// Dokument verwerfen}/*** *	“Save” angewählt ***/void	MSave(void){REG OSErr		err;	err = AppSaveDocument(gDoc,iSave);	// Dokument speichern	CheckOSError(err);					// oder ein Fehler?}/*** *	“SaveAs…” angewählt ***/void	MSaveAs(void){REG OSErr		err;	err = AppSaveDocument(gDoc,iSaveAs);// Dokument speichern	CheckOSError(err);					// oder ein Fehler?}/*** *	“Revert” angewählt ***/void	MRevert(void){REG OSErr		err;	err = AppRevertDocument(gDoc);		// Revert…	CheckOSError(err);					// oder ein Fehler?	DOC(revert,nil);					// Revert ausgeführt!}/*** *	“Duplicate” angewählt ***/void	MDuplicate(void){REG OSErr		err;DocHandle		d;	err = AppDuplicateDocument(gDoc,&d);// aktuelles Dokument verdoppeln	err = AppInitDocument(d,iOpen,err);	CheckOSError(err);					// ein Fehler => raus}/*** *	Druckersetup ***/void	MPageSetup(void){OSErr	err;	err = PageSetup(gDoc);				// Drucker-Setup	CheckOSError(err);					// Nein, dann ein Fehler?}							/*** *	Druckersetup ***/void	MPrint(void){OSErr	err;	err = noErr;	if (!ADOC.printvalid)				// Drucker-Struktur eingerichtet?		err = PageSetup(gDoc);			// Nein, einrichten	if (!err) {		err = AppPrintDocument(gDoc,true,true);		AppPrintDocument(nil,false,false);	}	CheckOSError(err);					// dann evtl. Fehler melden}/*** *	“Quit” angewählt ***/#include "File.h"#include <Aliases.h>void	MQuit(void){REG OSErr	err;WORD		id;	gSaveSettings = true;			// Settings stets speichern	SaveInstall();					// Preferences ggf. erzeugen	id = 128;						// ab ID 128 Alias-Resourcen anlegen	while(gDocList) {						// alle Dokumente zu?		err = AppSaveDocument(gDocList,iQuit);	// Dokument schließen		if(err == userCanceledErr) return;		// Abbruch durch den User?		if(!CheckOSError(err)) break;			// ein Fehler => raus		MakeDefaultDoc(gDocList,id++);		AppDisposeDocument(gDocList);		// Dokument verwerfen		SetDoc(gDocList);					// erstes Dokument aktiv	}	CloseWindAll(nil);						// restliche Windows schließen	gQuitApplication = true;				// Programm verlassen}